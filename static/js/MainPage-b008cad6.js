import{e as V}from"./index-4541571d.js";import{_ as x,u as I,U as r,N as y,r as g,o as c,c as h,a as b,b as l,w as o,d as u,F as B,e as P,f as L,t as p,g as T,p as q,h as A}from"./index-ef42d13c.js";import{C as R}from"./ChainHelper-98299809.js";const E={name:"MainPage",components:{},data(){return{chainStore:I(),searchDomain:"",e:V,u:r,allNSList:[],queryResultList:[],nsDetailDialog:{bVisible:!1,ns:"",tableData:[]},nameDetailDialog:{bVisible:!1,fullName:"",tableData:[]}}},async mounted(){let t=this;this.chainStore.bLoadNSFinish&&t.allNSList.push(...t.chainStore.getOpenRegistrationNamespaceList()),r.registerEventByType("namespaceReady",function(s){t.allNSList.splice(0,t.allNSList.length),t.allNSList.push(...t.chainStore.getOpenRegistrationNamespaceList())})},methods:{async onClickSearch(){if(this.searchDomain=this.searchDomain.toLowerCase(),this.searchDomain.trim().length==0){r.tipError("Please input domain");return}let t=[],s=[];const i=this.searchDomain.trim().split(".");if(i.length==2){if(!i[1]){r.alert("Invalid name");return}if(!i[1].match(/^[a-z]{1}[a-z|0-9|_]{0,31}$/)){r.alert(`Invalid namespace ${i[1]}`);return}if(!this.chainStore.getNamespaceInfo(i[1])){r.alert(`Namespace ${i[1]} hasn't been created`);return}s.push(i[0]),t.push(i[1])}else if(i.length==1)for(let n=0;n<this.allNSList.length;n++)s.push(i[0]),t.push(this.allNSList[n]);else{r.tipError("Domain invalid");return}const f=await y.queryManyNames(t,s),a=f[0],_=f[1],w=f[2];this.queryResultList.splice(0,this.queryResultList.length);for(let n=0;n<s.length;n++){let d={};if(d.name=s[n],d.ns=t[n],d.fullName=`${s[n]}.${t[n]}`,d.bCanRegister=a[n],d.bCanRegister){d.registerPrice=w[n];const[v,k,N]=y.calcRenewal(t[n],d.registerPrice);d.renewalStr=k}else d.registerPrice=0,d.owner=_[n];const m=this.chainStore.getNamespaceInfo(t[n]);d.bOpenRegistration=m.openStamp>0,this.queryResultList.push(d)}},onClickViewNSDetail(t){this.nsDetailDialog.ns=t;let s=this.nsDetailDialog.tableData;s.splice(0,s.length);let i=y.genNSInfoTableData(t);i&&s.push(...i),this.nsDetailDialog.bVisible=!0},async onClickRegister(t){await this.chainStore.requestLogin();const s=this.chainStore.address,i=await this.chainStore.getNameContract().resolveAddress(s);if(i.bResult){const a=r.bytes32ToStr(i.namespace),_=r.bytes32ToStr(i.name);r.alert(`One address can only own one name, current address already own ${_}.${a}`);return}if((await R.getBalance(s)).lte(t.registerPrice)){r.alert("Balance unenough");return}R.callExternal(async function(a){return await a.register(r.str2Bytes32(t.ns),r.str2Bytes32(t.name),{value:t.registerPrice})},function(a){a.status==1?(r.alert("Register success"),r.postEvent({type:"register",data:{}})):r.alert("Register fail")})},async onClickDetail(t){this.nameDetailDialog.fullName=t.fullName;let s=this.nameDetailDialog.tableData;s.splice(0,s.length);const i=this.chainStore.getNamespaceInfo(t.ns),f=await y.resolveAddressFull(t.owner,!1),a=y.genNameKVPairTableData(f);s.push(...a),s.push({name:"Namespace desc",value:y.getNamespaceDesc(t.ns,i.desc),bHtml:!0}),s.push({name:"Namespace admin",value:i.admin,bAddress:!0}),this.nameDetailDialog.bVisible=!0}}},D=t=>(q("data-v-765e7fad"),t=t(),A(),t),H={id:"main"},M=D(()=>u("div",{id:"subTitle"},"Decentral name",-1)),O={id:"searchArea"},U=D(()=>u("span",{style:{"font-weight":"bold","font-size":"16px"}},"Search",-1)),z={id:"nsArea"},F={style:{margin:"10px auto"},class:"sstrong sBlack"},G={key:0},K={class:"sstrong sBlack"},Z={class:"ggeneric sGrey"},j={key:1},J=D(()=>u("div",{class:"sstrong sGrey"},"Not open registration",-1)),Q=[J],W={key:2},X=D(()=>u("div",{class:"sstrong sGrey"},"Registered",-1)),Y=[X],$={key:3},ee=D(()=>u("div",{class:"sstrong sGrey"},"Unknown reason",-1)),te=[ee],ae={key:0},se={key:1},ie={key:0},ne={key:1},le=["innerHTML"],oe={key:2},re={key:0},ce={key:1},de=["innerHTML"],he={key:2};function ue(t,s,i,f,a,_){const w=g("el-input"),n=g("el-button"),d=g("router-link"),m=g("el-table-column"),v=g("el-table"),k=g("el-space"),N=g("el-link"),S=g("el-dialog");return c(),h("div",H,[b(" Â  "),M,l(k,{direction:"vertical",alignment:"start"},{default:o(()=>[u("div",O,[l(w,{modelValue:a.searchDomain,"onUpdate:modelValue":s[0]||(s[0]=e=>a.searchDomain=e),onChange:_.onClickSearch,clearable:"",placeholder:"Search a domain ...",style:{width:"650px",height:"55px","font-size":"20px"}},null,8,["modelValue","onChange"]),l(n,{type:"danger",style:{height:"55px",width:"128px","background-color":"#DE3723"},onClick:_.onClickSearch},{default:o(()=>[U]),_:1},8,["onClick"]),l(d,{id:"beastLink",to:"/tools/name/query-many"},{default:o(()=>[b("Beast Mode")]),_:1})]),u("div",z,[(c(!0),h(B,null,P(a.allNSList.length,e=>(c(),L(n,{key:e,class:"ns",type:"",text:"",onClick:C=>_.onClickViewNSDetail(a.allNSList[e-1])},{default:o(()=>[b(p("."+a.allNSList[e-1]),1)]),_:2},1032,["onClick"]))),128))]),a.queryResultList.length>0?(c(),L(v,{key:0,data:a.queryResultList,style:{margin:"50px auto",width:"800px"},"max-height":"600","empty-text":"Empty"},{default:o(()=>[l(m,{label:"Results",width:"180"},{default:o(e=>[u("div",F,p(e.row.fullName),1)]),_:1}),l(m,{label:""},{default:o(e=>[e.row.bCanRegister?(c(),h("div",G,[u("div",K,p(a.u.float2Str(a.e.utils.formatEther(e.row.registerPrice)))+" eth",1),u("div",Z,p(e.row.renewalStr),1)])):e.row.bOpenRegistration?e.row.owner!=a.e.ZeroAddress?(c(),h("div",W,Y)):(c(),h("div",$,te)):(c(),h("div",j,Q))]),_:1}),l(m,{label:"Action",width:"150"},{default:o(e=>[e.row.bCanRegister?(c(),h("div",ae,[l(n,{type:"primary",style:{width:"120px"},onClick:C=>_.onClickRegister(e.row)},{default:o(()=>[b("Register")]),_:2},1032,["onClick"])])):(c(),h("div",se,[l(n,{type:"info",style:{width:"120px"},onClick:C=>_.onClickDetail(e.row)},{default:o(()=>[b("Detail")]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])):T("",!0)]),_:1}),l(S,{modelValue:a.nsDetailDialog.bVisible,"onUpdate:modelValue":s[1]||(s[1]=e=>a.nsDetailDialog.bVisible=e),title:"."+a.nsDetailDialog.ns,width:"800px","align-center":""},{default:o(()=>[l(v,{data:a.nsDetailDialog.tableData,style:{width:"100%"},border:""},{default:o(()=>[l(m,{prop:"name",label:"Name",width:"180"}),l(m,{label:"Content"},{default:o(e=>[e.row.bAddress?(c(),h("div",ie,[l(N,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:o(()=>[b(p(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(c(),h("div",ne,[u("div",{innerHTML:e.row.value},null,8,le)])):(c(),h("div",oe,p(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),l(S,{modelValue:a.nameDetailDialog.bVisible,"onUpdate:modelValue":s[2]||(s[2]=e=>a.nameDetailDialog.bVisible=e),title:a.nameDetailDialog.fullName,width:"800px","align-center":""},{default:o(()=>[l(v,{data:a.nameDetailDialog.tableData,style:{width:"100%",margin:"0px auto"},stripe:"",border:""},{default:o(()=>[l(m,{prop:"name",label:"Name",width:"150",align:"center"}),l(m,{label:"Content"},{default:o(e=>[e.row.bAddress?(c(),h("div",re,[l(N,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:o(()=>[b(p(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(c(),h("div",ce,[u("div",{innerHTML:e.row.value},null,8,de)])):(c(),h("div",he,p(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}const pe=x(E,[["render",ue],["__scopeId","data-v-765e7fad"]]);export{pe as default};
