import{_ as L,u as A,U as n,N as g,C as _,j as U,k as E,l as T,i as P,r as w,o as C,c as D,d,b as c,w as m,t as v,g as S,f as x,a as f,p as M,h as R}from"./index-1d57afdd.js";const F={name:"NSToolManagerPage",components:{},data(){return{chainStore:A(),namespace:"",errTip:"",bAdmin:!1,nsInfo:{},tableData:[],setPriceData:{bVisible:!1,tableData:[{name:"1 Digit",value:"",unit:"ether"},{name:"1 Letter",value:"",unit:"ether"},{name:"_(underscore)",value:"",unit:"ether"},{name:"2 Digits",value:"",unit:"ether"},{name:"2 Letters",value:"",unit:"ether"},{name:"2 Misc",value:"",unit:"ether"},{name:"3 Digits",value:"",unit:"ether"},{name:"3 Letters",value:"",unit:"ether"},{name:"3 Misc",value:"",unit:"ether"},{name:"4 Digits",value:"",unit:"ether"},{name:"4 Letters",value:"",unit:"ether"},{name:"4 Misc",value:"",unit:"ether"},{name:"5 Digits",value:"",unit:"ether"},{name:"5 Letters",value:"",unit:"ether"},{name:"5 Misc",value:"",unit:"ether"},{name:"6 Digits",value:"",unit:"ether"},{name:"6 Letters",value:"",unit:"ether"},{name:"6 Misc",value:"",unit:"ether"},{name:"7 Digits",value:"",unit:"ether"},{name:"7 Letters",value:"",unit:"ether"},{name:"7 Misc",value:"",unit:"ether"},{name:"8 Digits",value:"",unit:"ether"},{name:"8 Letters",value:"",unit:"ether"},{name:"8 Misc",value:"",unit:"ether"},{name:"remain",value:"",unit:"ether"}],renewalParam:{a:0,b:1,c:1}},setCustomData:{bVisible:!1,bEditFlag:!1,minEditIndex:0,tableData:[]}}},async mounted(){let t=this;n.registerEventByType("resolveAddress",function(e){t.updateUI()}),n.registerEventByType("namespaceReady",function(e){t.updateUI()})},methods:{updateUI(){if(this.bAdmin=!1,this.errTip="",this.tableData.splice(0,this.tableData.length),this.namespace=this.namespace.trim(),this.namespace.startsWith(".")&&(this.namespace=this.namespace.substring(1)),this.namespace.length==0)return;if(!this.namespace.match(/^[a-z]{1}[a-z|0-9|_]{0,31}$/)){n.alert("Namespace invalid");return}this.nsInfo=this.chainStore.getNamespaceInfo(this.namespace);const t=g.genNSInfoTableData(this.namespace,{bIncludeNS:!0,bLaterShowOpenRegistration:!0});if(!t){n.alert("Namespace not find");return}let e=this.chainStore.address;e=e?e.toLowerCase():"";const a=e.toLowerCase()==this.nsInfo.admin.toLowerCase(),o=e.toLowerCase()==this.nsInfo.beneficiary.toLowerCase();this.bAdmin=a;const i=_.isZeroAddress(this.nsInfo.admin);!a&&!o&&(this.errTip="Current login address is neither namespace's admin, nor namespace's beneficiary.");for(const s of t)s.name=="Description"||s.name=="Admin"?(s.bShowEdit=!i,s.bCanEdit=a,s.editBtnName="Change"):s.name=="Beneficiary"?(s.bShowEdit=!i,s.bCanEdit=a||o,s.editBtnName="Change"):s.name=="Open registration"?(s.bShowEdit=!i&&this.nsInfo.openStamp==0,s.bCanEdit=a&&this.nsInfo.openStamp==0,s.editBtnName="Open registration"):s.name=="Registration price"||s.name=="Renewal price"||s.name=="Custom price names"?(s.bShowEdit=!i&&this.nsInfo.bAllowModifyPrice,s.bCanEdit=a&&this.nsInfo.bAllowModifyPrice,s.editBtnName="Change"):s.name=="Price unchangeable"&&(s.bShowEdit=!i&&this.nsInfo.bAllowModifyPrice,s.bCanEdit=a&&this.nsInfo.bAllowModifyPrice,s.editBtnName="Disable modify price");this.tableData.push(...t)},onClickChange(t){console.log("onClickChange",t);let e=this;if(t=="Description")n.prompt("",`Change ${t.toLowerCase()}`,{okCallback:function(a){e.briefChange(t,a)}});else if(t=="Admin"||t=="Beneficiary")n.prompt("",`Change ${t.toLowerCase()}`,{okCallback:function(a){e.briefChange(t,a)}});else if(t=="Open registration"){if(this.nsInfo.renewalPriceParam.c==0){n.alert("Please set price first!");return}_.callExternal(async function(a){return await a.openRegistration(n.str2Bytes32(e.namespace))},function(a){a.status==1?(n.alert("Open registration success, now anybody can register names in your namespace!"),g.syncNamespaceInfos()):n.alert("Open registration fail")})}else if(t=="Registration price"||t=="Renewal price")this.showSetPriceDialog();else if(t=="Custom price names")this.showCustomNamePriceDialog();else if(t=="Price unchangeable"){if(this.nsInfo.renewalPriceParam.c==0){n.alert("Please set price first!");return}_.callExternal(async function(a){return await a.disableModifyPrice(n.str2Bytes32(e.namespace))},function(a){a.status==1?(n.alert("Disable modify price success, now nobody can change price any more!"),g.syncNamespaceInfos()):n.alert("Disable modify price fail")})}},briefChange(t,e){console.log("briefChange",t,e),e=e.trim();let a=this;if(t=="Description"){if(e.length>=256){n.alert("Description length should small than 256!");return}_.callExternal(async function(o){return await o.setNamespaceDesc(n.str2Bytes32(a.namespace),U(e))},function(o){o.status==1?(n.alert("Change description success"),g.syncNamespaceInfos()):n.alert("Change description fail")})}else if(t=="Admin"){if(!E(e)){n.alert("Invalid address");return}_.callExternal(async function(o){return await o.transferNamespaceAdmin(n.str2Bytes32(a.namespace),e)},function(o){o.status==1?(n.alert("Change admin success"),g.syncNamespaceInfos()):n.alert("Change admin fail")})}else if(t=="Beneficiary"){if(!E(e)){n.alert("Invalid address");return}_.callExternal(async function(o){return await o.setNamespaceBeneficiary(n.str2Bytes32(a.namespace),e)},function(o){o.status==1?(n.alert("Change beneficiary success"),g.syncNamespaceInfos()):n.alert("Change beneficiary fail")})}},checkIntParam(t,e){const a=`Invalid renewal price param ${e}!`;if(t.toString().indexOf(".")!=-1)return n.alert(a),-1;const o=parseInt(t);return!o&&o!=0?(n.alert(a),-1):o<0||o>=1e3?(n.alert(a),-1):o},showSetPriceDialog(){let t=this.setPriceData;for(let e of t.tableData)e.value="",e.unit="ether";t.renewalParam={a:0,b:1,c:1},t.bVisible=!0},onClickSureSetPrice(){for(const u of this.setPriceData.tableData){const r=u.value?parseFloat(u.value.toString().trim()):"";if(!r){n.alert(`${u.name} price invalid!`);return}u.value=r}let t=this.setPriceData.renewalParam;const e=this.checkIntParam(t.a,"a");if(e==-1)return;const a=this.checkIntParam(t.b,"b");if(a==-1)return;const o=this.checkIntParam(t.c,"c");if(o==-1)return;let i=[];for(const u of this.setPriceData.tableData)i.push(T(u.value.toString(),u.unit));let s=P(e.toString()).mul(1e6).add(a*1e3+o);console.log("___renewalParamValue: ",s);let p=this;_.callExternal(async function(u){return await u.setPrice(n.str2Bytes32(p.namespace),i,s)},function(u){u.status==1?(n.alert("Set price success!"),g.syncNamespaceInfos()):n.alert("Set price fail")})},async showCustomNamePriceDialog(){const[t,e]=await g.getCustomPriceInfo(this.namespace);let a=this.setCustomData;a.bVisible=!0,a.bEditFlag=!1,a.minEditIndex=t.length,a.tableData.splice(0,a.tableData.length);for(let o=0;o<t.length;o++)a.tableData.push({index:a.tableData.length,name:t[o],price:e[o]});a.bVisible=!0},onClickAddRecord(){this.setCustomData.bEditFlag=!0,this.setCustomData.tableData.push({index:this.setCustomData.tableData.length,name:"",price:""})},onCloseCustomPriceDrawer(){if(!this.setCustomData.bEditFlag){this.setCustomData.bVisible=!1;return}let t=this;this.$confirm("Cancel set custom name price?","",{confirmButtonText:"Yes",cancelButtonText:"No"}).then(()=>{t.setCustomData.bVisible=!1})},async onClickSureSetCustomNamePrice(){let t=this.setCustomData;if(!t.bEditFlag){n.alert("No change!");return}let e={};for(let r=0;r<t.tableData.length;r++){const h=t.tableData[r];if(h.name=h.name.toLowerCase(),!h.name.match(/^[a-z|0-9|_]{1,32}$/)){n.alert(`Error: invalid names for row ${r+1}.`);return}if(e[h.name]){n.alert(`Error: names are equal(row ${r+1} vs row ${e[row.name]}`);return}if(e[h.name]=r+1,h.price.trim().length==0||!h.price.match(/^[0-9|_]{1}[0-9|\.]{0,20}$/)||!parseFloat(h.price)||!P(h.price)){n.alert(`Invalid price for name ${h.name}(row ${r+1})`);return}}const[a,o]=await g.getCustomPriceInfo(this.namespace,!0);let i={};for(let r=0;r<a.length;r++)i[a[r]]=o[r];let s=[],p=[];for(const r of t.tableData)(!i[r.name]||!i[r.name].eq(P(r.price)))&&(s.push(n.str2Bytes32(r.name)),p.push(P(r.price)));let u=this;_.callExternal(async function(r){return u.setCustomData.bEditFlag=!1,await r.setCustomPrice(n.str2Bytes32(u.namespace),s,p)},function(r){r.status==1?(n.alert("Set custom name price success!"),g.syncNamespaceInfos()):n.alert("Set custom name price fail!")})}}},y=t=>(M("data-v-bec34d05"),t=t(),R(),t),z=y(()=>d("div",{id:"inestTitle"},"Manager namespace",-1)),O=y(()=>d("div",{id:"inestTip"},[d("div",null,"Namespace's admin can change attributes, namespace's beneficiary can change the beneficiary address.")],-1)),H={id:"nsArea"},q={key:0,id:"errTip"},W={key:0},Z={key:1},j=["innerHTML"],Q={key:2},Y={key:0},G=y(()=>d("div",{style:{"font-weight":"200"}},"Registration price:",-1)),J={style:{"font-weight":"200","margin-bottom":"16px"}},K=y(()=>d("div",null,"Renewal price: (a + b * Registration-price) / c.",-1)),X=y(()=>d("div",{style:{color:"grey"}},"Attention: a,b,c should all less than 1000.",-1)),$=y(()=>d("div",{style:{color:"#333"}},"Name only allows 0-9, a-z, _, max 32 characters.",-1)),ee={key:0},te={style:{"margin-top":"32px"}};function ae(t,e,a,o,i,s){const p=w("el-input"),u=w("el-button"),r=w("el-table-column"),h=w("el-link"),V=w("el-table"),N=w("el-option"),B=w("el-select"),I=w("el-space"),k=w("el-drawer");return C(),D("div",null,[z,O,d("div",H,[c(p,{size:"large",class:"createNSItemWidth",maxlength:"32",clearable:"",modelValue:i.namespace,"onUpdate:modelValue":e[0]||(e[0]=l=>i.namespace=l),placeholder:"Input namespace",onChange:s.updateUI},null,8,["modelValue","onChange"]),c(u,{type:"primary",size:"large",style:{"margin-left":"8px"},disabled:i.namespace.trim().length==0,onClick:s.updateUI},{default:m(()=>[f("Query")]),_:1},8,["disabled","onClick"])]),i.errTip.length>0?(C(),D("div",q,v(i.errTip),1)):S("",!0),i.tableData.length>0?(C(),x(V,{key:1,data:i.tableData,style:{width:"800px"},border:""},{default:m(()=>[c(r,{prop:"name",label:"Name",width:"180"}),c(r,{label:"Content"},{default:m(l=>[l.row.bAddress?(C(),D("div",W,[c(h,{class:"elink",href:"https://etherscan.io/address/"+l.row.value,target:"_blank"},{default:m(()=>[f(v(l.row.value),1)]),_:2},1032,["href"])])):l.row.bHtml?(C(),D("div",Z,[d("div",{innerHTML:l.row.value},null,8,j)])):(C(),D("div",Q,v(l.row.value),1))]),_:1}),c(r,{label:"Edit",width:"160"},{default:m(l=>[l.row.bShowEdit?(C(),D("div",Y,[c(u,{type:"primary",size:"small",plain:"",disabled:!l.row.bCanEdit,onClick:b=>s.onClickChange(l.row.name)},{default:m(()=>[f(v(l.row.editBtnName),1)]),_:2},1032,["disabled","onClick"])])):S("",!0)]),_:1})]),_:1},8,["data"])):S("",!0),c(k,{title:"Set price",modelValue:i.setPriceData.bVisible,"onUpdate:modelValue":e[4]||(e[4]=l=>i.setPriceData.bVisible=l),direction:"rtl",size:"500px"},{default:m(()=>[c(I,{direction:"vertical",alignment:"start"},{default:m(()=>[G,c(V,{data:i.setPriceData.tableData,size:"small",style:{width:"400px","margin-bottom":"16px"},stripe:"",border:""},{default:m(()=>[c(r,{prop:"name",label:"Name",width:"120",align:"center"}),c(r,{label:"Price"},{default:m(l=>[c(p,{modelValue:l.row.value,"onUpdate:modelValue":b=>l.row.value=b},{append:m(()=>[c(B,{modelValue:l.row.unit,"onUpdate:modelValue":b=>l.row.unit=b,placeholder:"Select",style:{width:"80px"}},{default:m(()=>[c(N,{label:"ether",value:"ether"}),c(N,{label:"wei",value:"wei"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),d("div",J,[c(I,{direction:"vertical",alignment:"start"},{default:m(()=>[K,c(p,{modelValue:i.setPriceData.renewalParam.a,"onUpdate:modelValue":e[1]||(e[1]=l=>i.setPriceData.renewalParam.a=l)},{prepend:m(()=>[f("a(integer):")]),append:m(()=>[f("ether")]),_:1},8,["modelValue"]),c(p,{modelValue:i.setPriceData.renewalParam.b,"onUpdate:modelValue":e[2]||(e[2]=l=>i.setPriceData.renewalParam.b=l)},{prepend:m(()=>[f("b(integer):")]),_:1},8,["modelValue"]),c(p,{modelValue:i.setPriceData.renewalParam.c,"onUpdate:modelValue":e[3]||(e[3]=l=>i.setPriceData.renewalParam.c=l)},{prepend:m(()=>[f("c(integer):")]),_:1},8,["modelValue"]),X]),_:1})]),d("div",null,[c(u,{type:"primary",onClick:s.onClickSureSetPrice,disabled:i.setPriceData.tableData.length>=200},{default:m(()=>[f("Set price")]),_:1},8,["onClick","disabled"])])]),_:1})]),_:1},8,["modelValue"]),c(k,{title:"Set custom name price",modelValue:i.setCustomData.bVisible,"onUpdate:modelValue":e[8]||(e[8]=l=>i.setCustomData.bVisible=l),"before-close":s.onCloseCustomPriceDrawer,direction:"rtl",size:"650px"},{default:m(()=>[c(I,{direction:"vertical",alignment:"start"},{default:m(()=>[$,c(V,{data:i.setCustomData.tableData,style:{width:"550px"},stripe:"",border:""},{default:m(()=>[c(r,{type:"index",width:"50",align:"center"}),c(r,{prop:"name",label:"Name",width:"280",align:"center"},{default:m(l=>[l.row.index<i.setCustomData.minEditIndex?(C(),D("span",ee,v(l.row.name),1)):(C(),x(p,{key:1,modelValue:l.row.name,"onUpdate:modelValue":b=>l.row.name=b,onInput:e[5]||(e[5]=b=>i.setCustomData.bEditFlag=!0)},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),c(r,{label:"Price"},{default:m(l=>[c(p,{modelValue:l.row.price,"onUpdate:modelValue":b=>l.row.price=b,onInput:e[6]||(e[6]=b=>i.setCustomData.bEditFlag=!0)},{append:m(()=>[f("ether")]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]),d("div",null,[c(u,{type:"primary",plain:"",onClick:s.onClickAddRecord,disabled:i.setCustomData.tableData.length>=200},{default:m(()=>[f("Add")]),_:1},8,["onClick","disabled"]),c(u,{type:"info",plain:"",onClick:e[7]||(e[7]=l=>i.setCustomData.tableData.splice(i.setCustomData.tableData.length-1)),disabled:i.setCustomData.tableData.length<=i.setCustomData.minEditIndex},{default:m(()=>[f("Remove last")]),_:1},8,["disabled"])]),d("div",te,[c(u,{type:"primary",disabled:!i.setCustomData.bEditFlag,onClick:s.onClickSureSetCustomNamePrice},{default:m(()=>[f("Set custom name price")]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1},8,["modelValue","before-close"])])}const ne=L(F,[["render",ae],["__scopeId","data-v-bec34d05"]]);export{ne as default};
