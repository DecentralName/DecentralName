import{e as x}from"./index-7579c901.js";import{_ as V,u as I,U as c,E as B,N as v,C as N,r as g,o as d,c as u,a as p,b as o,w as r,d as h,F as T,e as E,f as R,t as m,g as P,p as q,h as A}from"./index-7a968897.js";const M={name:"MainPage",components:{},data(){return{chainStore:I(),searchDomain:"",e:x,u:c,allNSList:[],queryResultList:[],nsDetailDialog:{bVisible:!1,ns:"",tableData:[]},nameDetailDialog:{bVisible:!1,fullName:"",tableData:[]}}},async mounted(){let t=this;this.chainStore.bLoadNSFinish&&t.allNSList.push(...t.chainStore.getOpenRegistrationNamespaceList()),c.registerEventByType("namespaceReady",function(s){t.allNSList.splice(0,t.allNSList.length),t.allNSList.push(...t.chainStore.getOpenRegistrationNamespaceList())})},methods:{async onClickSearch(){if(this.searchDomain=this.searchDomain.toLowerCase(),this.searchDomain.trim().length==0){c.tipError("Please input domain");return}let t=[],s=[];const l=this.searchDomain.trim().split(".");if(l.length==2){if(!l[1]){c.alert("Invalid name");return}if(!l[1].match(/^[a-z]{1}[a-z|0-9|_]{0,31}$/)){c.alert(`Invalid namespace ${l[1]}`);return}if(!this.chainStore.getNamespaceInfo(l[1])){c.alert(`Namespace ${l[1]} hasn't been created`);return}s.push(l[0]),t.push(l[1])}else if(l.length==1){if(!l[0].match(/^[a-z|0-9|_]{1,32}$/)){c.alert("Invalid name");return}for(let i=0;i<this.allNSList.length;i++)s.push(l[0]),t.push(this.allNSList[i])}else{c.tipError("Domain invalid");return}let b=B.service({lock:!0,text:"Querying..",background:"rgba(0, 0, 0, 0.6)"}),a=null;try{a=await v.queryManyNames(t,s)}catch{N.alertRequestFail();return}finally{b.close()}const _=a[0],w=a[1],k=a[2];this.queryResultList.splice(0,this.queryResultList.length);for(let i=0;i<s.length;i++){let n={};if(n.name=s[i],n.ns=t[i],n.fullName=`${s[i]}.${t[i]}`,n.bCanRegister=_[i],n.bCanRegister){n.registerPrice=k[i];const[L,D,S]=v.calcRenewal(t[i],n.registerPrice);n.renewalStr=D}else n.registerPrice=0,n.owner=w[i];const y=this.chainStore.getNamespaceInfo(t[i]);n.bOpenRegistration=y.openStamp>0,this.queryResultList.push(n)}},onClickViewNSDetail(t){this.nsDetailDialog.ns=t;let s=this.nsDetailDialog.tableData;s.splice(0,s.length);let l=v.genNSInfoTableData(t,{bExcludeBeneficiary:!0,bExcludeOpenRegistration:!0});l&&s.push(...l),this.nsDetailDialog.bVisible=!0},async onClickRegister(t){if(await this.chainStore.requestLogin(),!this.chainStore.address)return;const s=this.chainStore.address,l=await this.chainStore.getNameContract().resolveAddress(s);if(l.bResult){const a=c.bytes32ToStr(l.namespace),_=c.bytes32ToStr(l.name);c.alert(`One address can only own one name, current address already own ${_}.${a}`);return}if((await N.getBalance(s)).lte(t.registerPrice)){c.alert("Balance unenough");return}N.callExternal(async function(a){return await a.register(c.str2Bytes32(t.ns),c.str2Bytes32(t.name),{value:t.registerPrice})},function(a){a.status==1?(c.alert("Register success"),c.postEvent({type:"register",data:{}})):c.alert("Register fail")})},async onClickDetail(t){this.nameDetailDialog.fullName=t.fullName;let s=this.nameDetailDialog.tableData;s.splice(0,s.length),this.chainStore.getNamespaceInfo(t.ns);const l=await v.resolveAddressFull(t.owner,!1),b=v.genNameKVPairTableData(l);s.push(...b),this.nameDetailDialog.bVisible=!0}}},f=t=>(q("data-v-6023273e"),t=t(),A(),t),H={id:"main"},O=f(()=>h("div",{id:"subTitle"},"Decentral Name",-1)),U=f(()=>h("div",{id:"subTitle2"},"The Web3 DNS",-1)),z={id:"searchArea"},F={id:"searchInput"},G=f(()=>h("span",{style:{"font-weight":"bold","font-size":"16px"}},"Search",-1)),K={id:"nsArea"},Q={style:{margin:"10px auto"},class:"sstrong sBlack"},W={key:0},Z={class:"sstrong sBlack"},j={class:"ggeneric sGrey"},J={key:1},X=f(()=>h("div",{class:"sstrong sGrey"},"Not open registration",-1)),Y=[X],$={key:2},ee=f(()=>h("div",{class:"sstrong sGrey"},"Registered",-1)),te=[ee],ae={key:3},se=f(()=>h("div",{class:"sstrong sGrey"},"Unknown reason",-1)),ie=[se],le={key:0},ne={key:1},oe={key:0},re={key:1},ce=["innerHTML"],de={key:2},ue={key:0},he={key:1},_e={key:2},me=["innerHTML"],ge={key:3};function pe(t,s,l,b,a,_){const w=g("el-input"),k=g("router-link"),i=g("el-button"),n=g("el-table-column"),y=g("el-table"),L=g("el-space"),D=g("el-link"),S=g("el-dialog");return d(),u("div",H,[p(" Â  "),O,U,o(L,{direction:"vertical",alignment:"start"},{default:r(()=>[h("div",z,[h("div",F,[o(w,{id:"inputDomain",modelValue:a.searchDomain,"onUpdate:modelValue":s[0]||(s[0]=e=>a.searchDomain=e),onChange:_.onClickSearch,placeholder:"Search a domain",style:{width:"650px",height:"55px","font-size":"20px"}},null,8,["modelValue","onChange"]),o(k,{id:"beastLink",to:"/tools/name/query-many"},{default:r(()=>[p("Beast Mode")]),_:1})]),o(i,{type:"danger",style:{height:"55px",width:"128px","background-color":"#DE3723"},onClick:_.onClickSearch},{default:r(()=>[G]),_:1},8,["onClick"])]),h("div",K,[(d(!0),u(T,null,E(a.allNSList.length,e=>(d(),R(i,{key:e,class:"ns",type:"",text:"",onClick:C=>_.onClickViewNSDetail(a.allNSList[e-1])},{default:r(()=>[p(m("."+a.allNSList[e-1]),1)]),_:2},1032,["onClick"]))),128))]),a.queryResultList.length>0?(d(),R(y,{key:0,data:a.queryResultList,style:{margin:"50px auto",width:"800px"},"max-height":"600","empty-text":"Empty"},{default:r(()=>[o(n,{label:"Results",width:"180"},{default:r(e=>[h("div",Q,m(e.row.fullName),1)]),_:1}),o(n,{label:""},{default:r(e=>[e.row.bCanRegister?(d(),u("div",W,[h("div",Z,m(a.u.float2Str(a.e.utils.formatEther(e.row.registerPrice)))+" eth",1),h("div",j,m(e.row.renewalStr),1)])):e.row.bOpenRegistration?e.row.owner!=a.e.ZeroAddress?(d(),u("div",$,te)):(d(),u("div",ae,ie)):(d(),u("div",J,Y))]),_:1}),o(n,{label:"Action",width:"150"},{default:r(e=>[e.row.bCanRegister?(d(),u("div",le,[o(i,{type:"primary",style:{width:"120px"},onClick:C=>_.onClickRegister(e.row)},{default:r(()=>[p("Register")]),_:2},1032,["onClick"])])):(d(),u("div",ne,[o(i,{type:"info",style:{width:"120px"},onClick:C=>_.onClickDetail(e.row)},{default:r(()=>[p("Detail")]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])):P("",!0)]),_:1}),o(S,{modelValue:a.nsDetailDialog.bVisible,"onUpdate:modelValue":s[1]||(s[1]=e=>a.nsDetailDialog.bVisible=e),title:"."+a.nsDetailDialog.ns,width:"800px","align-center":""},{default:r(()=>[o(y,{data:a.nsDetailDialog.tableData,style:{width:"100%"},border:""},{default:r(()=>[o(n,{prop:"name",label:"Name",width:"180"}),o(n,{label:"Content"},{default:r(e=>[e.row.bAddress?(d(),u("div",oe,[o(D,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:r(()=>[p(m(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(d(),u("div",re,[h("div",{innerHTML:e.row.value},null,8,ce)])):(d(),u("div",de,m(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),o(S,{modelValue:a.nameDetailDialog.bVisible,"onUpdate:modelValue":s[2]||(s[2]=e=>a.nameDetailDialog.bVisible=e),title:a.nameDetailDialog.fullName,width:"800px","align-center":""},{default:r(()=>[o(y,{data:a.nameDetailDialog.tableData,style:{width:"100%",margin:"0px auto"},stripe:"",border:""},{default:r(()=>[o(n,{prop:"name",label:"Name",width:"150",align:"center"}),o(n,{label:"Content"},{default:r(e=>[e.row.bAddress?(d(),u("div",ue,[o(D,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:r(()=>[p(m(e.row.value),1)]),_:2},1032,["href"])])):e.row.bLink?(d(),u("div",he,[o(D,{class:"elink",href:e.row.value,target:"_blank"},{default:r(()=>[p(m(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(d(),u("div",_e,[h("div",{innerHTML:e.row.value},null,8,me)])):(d(),u("div",ge,m(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}const ye=V(M,[["render",pe],["__scopeId","data-v-6023273e"]]);export{ye as default};
