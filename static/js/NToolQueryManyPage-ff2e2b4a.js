import{_ as D,U as o,u as V,E as B,N as v,r as g,o as r,c as d,d as i,b as c,w as u,f as x,g as P,F as T,e as q,a as w,t as k,p as I,h as E}from"./index-ef42d13c.js";import{C}from"./ChainHelper-98299809.js";import{e as Q}from"./index-4541571d.js";const A={name:"NToolQueryManyPage",components:{},data(){return{e:Q,u:o,chainStore:V(),allNSList:[],checkList:[],namesStr:"",queryResultList:[],nameDetailDialog:{bVisible:!1,fullName:"",tableData:[]}}},async mounted(){this.allNSList.push(...this.chainStore.getOpenRegistrationNamespaceList());let l=this;o.registerEventByType("namespaceReady",function(a){l.allNSList.splice(0,l.allNSList.length),l.allNSList.push(...l.chainStore.getOpenRegistrationNamespaceList())})},methods:{async onClickQuery(){if(this.checkList.length<=0){o.alert("Please select namespaces!");return}let l=[],a={};const m=this.namesStr.split(`
`);for(let s=0;s<m.length;s++){const n=m[s].trim();if(!(n.trim().length<=0)){if(!n.match(/^[a-z|0-9|_]{1,32}$/)){o.alert(`Invalid name ${n}`);return}l.push(n),a[n]=s+1}}if(l.length>100){o.alert("Max 100 names");return}if(this.checkList.length*l.length>500){o.alert(`Selected namespace count(${this.checkList.length}) multiples names count(${l.length}) should less than 500.`);return}let h=[],e=[];for(const s of l)for(const n of this.checkList)h.push(n.substring(1)),e.push(s);let p=B.service({lock:!0,text:"Querying..",background:"rgba(0, 0, 0, 0.6)"});const f=await v.queryManyNames(h,e);p.close();const N=f[0],S=f[1],b=f[2];this.queryResultList.splice(0,this.queryResultList.length);let _=[];for(let s=0;s<e.length;s++){let n={};if(n.name=e[s],n.ns=h[s],n.fullName=`${e[s]}.${h[s]}`,n.bCanRegister=N[s],n.bCanRegister){n.registerPrice=b[s];const[t,R,de]=v.calcRenewal(h[s],n.registerPrice);n.renewalStr=R}else n.registerPrice=0,n.owner=S[s];const L=this.chainStore.getNamespaceInfo(h[s]);n.bOpenRegistration=L.openStamp>0,_.push(n)}_.sort(function(s,n){return s.bCanRegister!=n.bCanRegister?s.bCanRegister?-1:1:s.name!=n.name?a[s.name]<a[n.name]?-1:1:s.ns<n.ns}),this.queryResultList.push(..._)},async onClickRegister(l){await this.chainStore.requestLogin();const a=this.chainStore.address,m=await this.chainStore.getNameContract().resolveAddress(a);if(m.bResult){const e=o.bytes32ToStr(m.namespace),p=o.bytes32ToStr(m.name);o.alert(`One address can only own one name, current address already own ${p}.${e}`);return}if((await C.getBalance(a)).lte(l.registerPrice)){o.alert("Balance unenough");return}C.callExternal(async function(e){return await e.register(o.str2Bytes32(l.ns),o.str2Bytes32(l.name),{value:l.registerPrice})},function(e){e.status==1?(o.alert("Register success"),o.postEvent({type:"register",data:{}})):o.alert("Register fail")})},async onClickDetail(l){this.nameDetailDialog.fullName=l.fullName;let a=this.nameDetailDialog.tableData;a.splice(0,a.length);const m=this.chainStore.getNamespaceInfo(l.ns),h=await v.resolveAddressFull(l.owner,!1),e=v.genNameKVPairTableData(h);a.push(...e),a.push({name:"Namespace desc",value:v.getNamespaceDesc(l.ns,m.desc),bHtml:!0}),a.push({name:"Namespace admin",value:m.admin,bAddress:!0}),this.nameDetailDialog.bVisible=!0}}},y=l=>(I("data-v-29e2bd83"),l=l(),E(),l),M=y(()=>i("div",{id:"inestTitle"},"Query many",-1)),H=y(()=>i("div",{id:"inestTip"},[i("div",null,"Query multiple names quickly!")],-1)),O={style:{"margin-top":"50px"}},U=y(()=>i("div",null,"Select namespaces:",-1)),z={style:{"margin-top":"32px"}},G=y(()=>i("div",null,"Enter names(only allow 0-9, a-z, _, one name per line, max 100 lines):",-1)),F={style:{margin:"10px auto"},class:"sstrong sBlack"},K={key:0},Z={class:"sstrong sBlack"},j={class:"ggeneric sGrey"},J={key:1},W=y(()=>i("div",{class:"sstrong sGrey"},"Not open registration",-1)),X=[W],Y={key:2},$=y(()=>i("div",{class:"sstrong sGrey"},"Registered",-1)),ee=[$],te={key:3},se=y(()=>i("div",{class:"sstrong sGrey"},"Unknown reason",-1)),ne=[se],le={key:0},ae={key:1},ie={key:0},oe={key:1},re=["innerHTML"],ce={key:2};function ue(l,a,m,h,e,p){const f=g("el-checkbox"),N=g("el-checkbox-group"),S=g("el-input"),b=g("el-button"),_=g("el-table-column"),s=g("el-table"),n=g("el-link"),L=g("el-dialog");return r(),d("div",null,[M,H,i("div",O,[U,c(N,{modelValue:e.checkList,"onUpdate:modelValue":a[0]||(a[0]=t=>e.checkList=t)},{default:u(()=>[(r(!0),d(T,null,q(e.allNSList.length,t=>(r(),x(f,{size:"large",key:t,label:"."+e.allNSList[t-1]},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",z,[G,c(S,{modelValue:e.namesStr,"onUpdate:modelValue":a[1]||(a[1]=t=>e.namesStr=t),style:{width:"600px","margin-top":"8px"},rows:16,type:"textarea",placeholder:"satoshi"},null,8,["modelValue"]),i("div",null,[c(b,{type:"primary",size:"large",style:{"margin-top":"8px"},disabled:e.namesStr.trim().length==0,onClick:p.onClickQuery},{default:u(()=>[w("Query")]),_:1},8,["disabled","onClick"])]),i("div",null,[e.queryResultList.length>0?(r(),x(s,{key:0,data:e.queryResultList,style:{margin:"50px auto",width:"600px"},"empty-text":"Empty"},{default:u(()=>[c(_,{label:"Results",width:"180"},{default:u(t=>[i("div",F,k(t.row.fullName),1)]),_:1}),c(_,{label:""},{default:u(t=>[t.row.bCanRegister?(r(),d("div",K,[i("div",Z,k(e.u.float2Str(e.e.utils.formatEther(t.row.registerPrice)))+" eth",1),i("div",j,k(t.row.renewalStr),1)])):t.row.bOpenRegistration?t.row.owner!=e.e.ZeroAddress?(r(),d("div",Y,ee)):(r(),d("div",te,ne)):(r(),d("div",J,X))]),_:1}),c(_,{label:"Action",width:"150"},{default:u(t=>[t.row.bCanRegister?(r(),d("div",le,[c(b,{type:"primary",style:{width:"120px"},onClick:R=>p.onClickRegister(t.row)},{default:u(()=>[w("Register")]),_:2},1032,["onClick"])])):(r(),d("div",ae,[c(b,{type:"info",style:{width:"120px"},onClick:R=>p.onClickDetail(t.row)},{default:u(()=>[w("Detail")]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])):P("",!0)])]),c(L,{modelValue:e.nameDetailDialog.bVisible,"onUpdate:modelValue":a[2]||(a[2]=t=>e.nameDetailDialog.bVisible=t),title:e.nameDetailDialog.fullName,width:"800px","align-center":""},{default:u(()=>[c(s,{data:e.nameDetailDialog.tableData,style:{width:"100%",margin:"0px auto"},stripe:"",border:""},{default:u(()=>[c(_,{prop:"name",label:"Name",width:"150",align:"center"}),c(_,{label:"Content"},{default:u(t=>[t.row.bAddress?(r(),d("div",ie,[c(n,{class:"elink",href:"https://etherscan.io/address/"+t.row.value,target:"_blank"},{default:u(()=>[w(k(t.row.value),1)]),_:2},1032,["href"])])):t.row.bHtml?(r(),d("div",oe,[i("div",{innerHTML:t.row.value},null,8,re)])):(r(),d("div",ce,k(t.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}const ge=D(A,[["render",ue],["__scopeId","data-v-29e2bd83"]]);export{ge as default};
