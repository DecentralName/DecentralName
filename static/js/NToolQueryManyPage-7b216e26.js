import{_ as D,U as o,u as V,E as B,N as w,C as x,r as g,o as r,c as d,d as i,b as c,w as u,f as C,g as P,F as T,e as q,a as v,t as f,p as E,h as I}from"./index-e819cab7.js";import{e as Q}from"./index-2a86eec3.js";const M={name:"NToolQueryManyPage",components:{},data(){return{e:Q,u:o,chainStore:V(),allNSList:[],checkList:[],namesStr:"",queryResultList:[],nameDetailDialog:{bVisible:!1,fullName:"",tableData:[]}}},async mounted(){this.allNSList.push(...this.chainStore.getOpenRegistrationNamespaceList());let l=this;o.registerEventByType("namespaceReady",function(a){l.allNSList.splice(0,l.allNSList.length),l.allNSList.push(...l.chainStore.getOpenRegistrationNamespaceList())})},methods:{async onClickQuery(){if(this.checkList.length<=0){o.alert("Please select namespaces!");return}this.namesStr=this.namesStr.toLowerCase();let l=[],a={};const _=this.namesStr.split(`
`);for(let n=0;n<_.length;n++){const s=_[n].trim();if(!(s.trim().length<=0)){if(!s.match(/^[a-z|0-9|_]{1,32}$/)){o.alert(`Invalid name ${s}`);return}l.push(s),a[s]=n+1}}if(l.length>100){o.alert("Max 100 names");return}if(this.checkList.length*l.length>500){o.alert(`Selected namespace count(${this.checkList.length}) multiples names count(${l.length}) should less than 500.`);return}let h=[],t=[];for(const n of l)for(const s of this.checkList)h.push(s.substring(1)),t.push(n);let p=B.service({lock:!0,text:"Querying..",background:"rgba(0, 0, 0, 0.6)"});const b=await w.queryManyNames(h,t);p.close();const S=b[0],L=b[1],k=b[2];this.queryResultList.splice(0,this.queryResultList.length);let m=[];for(let n=0;n<t.length;n++){let s={};if(s.name=t[n],s.ns=h[n],s.fullName=`${t[n]}.${h[n]}`,s.bCanRegister=S[n],s.bCanRegister){s.registerPrice=k[n];const[e,R,he]=w.calcRenewal(h[n],s.registerPrice);s.renewalStr=R}else s.registerPrice=0,s.owner=L[n];const N=this.chainStore.getNamespaceInfo(h[n]);s.bOpenRegistration=N.openStamp>0,m.push(s)}m.sort(function(n,s){return n.bCanRegister!=s.bCanRegister?n.bCanRegister?-1:1:n.name!=s.name?a[n.name]<a[s.name]?-1:1:n.ns<s.ns}),this.queryResultList.push(...m)},async onClickRegister(l){await this.chainStore.requestLogin();const a=this.chainStore.address,_=await this.chainStore.getNameContract().resolveAddress(a);if(_.bResult){const t=o.bytes32ToStr(_.namespace),p=o.bytes32ToStr(_.name);o.alert(`One address can only own one name, current address already own ${p}.${t}`);return}if((await x.getBalance(a)).lte(l.registerPrice)){o.alert("Balance unenough");return}x.callExternal(async function(t){return await t.register(o.str2Bytes32(l.ns),o.str2Bytes32(l.name),{value:l.registerPrice})},function(t){t.status==1?(o.alert("Register success"),o.postEvent({type:"register",data:{}})):o.alert("Register fail")})},async onClickDetail(l){this.nameDetailDialog.fullName=l.fullName;let a=this.nameDetailDialog.tableData;a.splice(0,a.length),this.chainStore.getNamespaceInfo(l.ns);const _=await w.resolveAddressFull(l.owner,!1),h=w.genNameKVPairTableData(_);a.push(...h),this.nameDetailDialog.bVisible=!0}}},y=l=>(E("data-v-4bce3015"),l=l(),I(),l),A=y(()=>i("div",{id:"inestTitle"},"Query many",-1)),O=y(()=>i("div",{id:"inestTip"},[i("div",null,"Query multiple names quickly!")],-1)),U={style:{"margin-top":"50px"}},H=y(()=>i("div",null,"Select namespaces:",-1)),z={style:{"margin-top":"32px"}},G=y(()=>i("div",null,"Enter names(only allow 0-9, a-z, _, one name per line, max 100 lines):",-1)),F={style:{margin:"10px auto"},class:"sstrong sBlack"},K={key:0},Z={class:"sstrong sBlack"},j={class:"ggeneric sGrey"},J={key:1},W=y(()=>i("div",{class:"sstrong sGrey"},"Not open registration",-1)),X=[W],Y={key:2},$=y(()=>i("div",{class:"sstrong sGrey"},"Registered",-1)),ee=[$],te={key:3},se=y(()=>i("div",{class:"sstrong sGrey"},"Unknown reason",-1)),ne=[se],le={key:0},ae={key:1},ie={key:0},oe={key:1},re={key:2},ce=["innerHTML"],ue={key:3};function de(l,a,_,h,t,p){const b=g("el-checkbox"),S=g("el-checkbox-group"),L=g("el-input"),k=g("el-button"),m=g("el-table-column"),n=g("el-table"),s=g("el-link"),N=g("el-dialog");return r(),d("div",null,[A,O,i("div",U,[H,c(S,{modelValue:t.checkList,"onUpdate:modelValue":a[0]||(a[0]=e=>t.checkList=e)},{default:u(()=>[(r(!0),d(T,null,q(t.allNSList.length,e=>(r(),C(b,{size:"large",key:e,label:"."+t.allNSList[e-1]},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",z,[G,c(L,{modelValue:t.namesStr,"onUpdate:modelValue":a[1]||(a[1]=e=>t.namesStr=e),style:{width:"600px","margin-top":"8px"},rows:16,type:"textarea",placeholder:"satoshi"},null,8,["modelValue"]),i("div",null,[c(k,{type:"primary",size:"large",style:{"margin-top":"8px"},disabled:t.namesStr.trim().length==0,onClick:p.onClickQuery},{default:u(()=>[v("Query")]),_:1},8,["disabled","onClick"])]),i("div",null,[t.queryResultList.length>0?(r(),C(n,{key:0,data:t.queryResultList,style:{margin:"50px auto",width:"600px"},"empty-text":"Empty"},{default:u(()=>[c(m,{label:"Results",width:"180"},{default:u(e=>[i("div",F,f(e.row.fullName),1)]),_:1}),c(m,{label:""},{default:u(e=>[e.row.bCanRegister?(r(),d("div",K,[i("div",Z,f(t.u.float2Str(t.e.utils.formatEther(e.row.registerPrice)))+" eth",1),i("div",j,f(e.row.renewalStr),1)])):e.row.bOpenRegistration?e.row.owner!=t.e.ZeroAddress?(r(),d("div",Y,ee)):(r(),d("div",te,ne)):(r(),d("div",J,X))]),_:1}),c(m,{label:"Action",width:"150"},{default:u(e=>[e.row.bCanRegister?(r(),d("div",le,[c(k,{type:"primary",style:{width:"120px"},onClick:R=>p.onClickRegister(e.row)},{default:u(()=>[v("Register")]),_:2},1032,["onClick"])])):(r(),d("div",ae,[c(k,{type:"info",style:{width:"120px"},onClick:R=>p.onClickDetail(e.row)},{default:u(()=>[v("Detail")]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])):P("",!0)])]),c(N,{modelValue:t.nameDetailDialog.bVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>t.nameDetailDialog.bVisible=e),title:t.nameDetailDialog.fullName,width:"800px","align-center":""},{default:u(()=>[c(n,{data:t.nameDetailDialog.tableData,style:{width:"100%",margin:"0px auto"},stripe:"",border:""},{default:u(()=>[c(m,{prop:"name",label:"Name",width:"150",align:"center"}),c(m,{label:"Content"},{default:u(e=>[e.row.bAddress?(r(),d("div",ie,[c(s,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:u(()=>[v(f(e.row.value),1)]),_:2},1032,["href"])])):e.row.bLink?(r(),d("div",oe,[c(s,{class:"elink",href:e.row.value,target:"_blank"},{default:u(()=>[v(f(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(r(),d("div",re,[i("div",{innerHTML:e.row.value},null,8,ce)])):(r(),d("div",ue,f(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}const ge=D(M,[["render",de],["__scopeId","data-v-4bce3015"]]);export{ge as default};
