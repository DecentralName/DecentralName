import{_ as D,U as o,u as V,E as B,N as k,C as x,r as g,o as r,c as d,d as i,b as c,w as u,f as C,g as P,F as T,e as q,a as w,t as f,p as I,h as E}from"./index-7507b3cc.js";import{e as Q}from"./index-49a74356.js";const A={name:"NToolQueryManyPage",components:{},data(){return{e:Q,u:o,chainStore:V(),allNSList:[],checkList:[],namesStr:"",queryResultList:[],nameDetailDialog:{bVisible:!1,fullName:"",tableData:[]}}},async mounted(){this.allNSList.push(...this.chainStore.getOpenRegistrationNamespaceList());let l=this;o.registerEventByType("namespaceReady",function(a){l.allNSList.splice(0,l.allNSList.length),l.allNSList.push(...l.chainStore.getOpenRegistrationNamespaceList())})},methods:{async onClickQuery(){if(this.checkList.length<=0){o.alert("Please select namespaces!");return}let l=[],a={};const h=this.namesStr.split(`
`);for(let n=0;n<h.length;n++){const s=h[n].trim();if(!(s.trim().length<=0)){if(!s.match(/^[a-z|0-9|_]{1,32}$/)){o.alert(`Invalid name ${s}`);return}l.push(s),a[s]=n+1}}if(l.length>100){o.alert("Max 100 names");return}if(this.checkList.length*l.length>500){o.alert(`Selected namespace count(${this.checkList.length}) multiples names count(${l.length}) should less than 500.`);return}let m=[],t=[];for(const n of l)for(const s of this.checkList)m.push(s.substring(1)),t.push(n);let p=B.service({lock:!0,text:"Querying..",background:"rgba(0, 0, 0, 0.6)"});const b=await k.queryManyNames(m,t);p.close();const L=b[0],N=b[1],v=b[2];this.queryResultList.splice(0,this.queryResultList.length);let _=[];for(let n=0;n<t.length;n++){let s={};if(s.name=t[n],s.ns=m[n],s.fullName=`${t[n]}.${m[n]}`,s.bCanRegister=L[n],s.bCanRegister){s.registerPrice=v[n];const[e,R,he]=k.calcRenewal(m[n],s.registerPrice);s.renewalStr=R}else s.registerPrice=0,s.owner=N[n];const S=this.chainStore.getNamespaceInfo(m[n]);s.bOpenRegistration=S.openStamp>0,_.push(s)}_.sort(function(n,s){return n.bCanRegister!=s.bCanRegister?n.bCanRegister?-1:1:n.name!=s.name?a[n.name]<a[s.name]?-1:1:n.ns<s.ns}),this.queryResultList.push(..._)},async onClickRegister(l){await this.chainStore.requestLogin();const a=this.chainStore.address,h=await this.chainStore.getNameContract().resolveAddress(a);if(h.bResult){const t=o.bytes32ToStr(h.namespace),p=o.bytes32ToStr(h.name);o.alert(`One address can only own one name, current address already own ${p}.${t}`);return}if((await x.getBalance(a)).lte(l.registerPrice)){o.alert("Balance unenough");return}x.callExternal(async function(t){return await t.register(o.str2Bytes32(l.ns),o.str2Bytes32(l.name),{value:l.registerPrice})},function(t){t.status==1?(o.alert("Register success"),o.postEvent({type:"register",data:{}})):o.alert("Register fail")})},async onClickDetail(l){this.nameDetailDialog.fullName=l.fullName;let a=this.nameDetailDialog.tableData;a.splice(0,a.length);const h=this.chainStore.getNamespaceInfo(l.ns),m=await k.resolveAddressFull(l.owner,!1),t=k.genNameKVPairTableData(m);a.push(...t),a.push({name:"Namespace desc",value:k.getNamespaceDesc(l.ns,h.desc),bHtml:!0}),a.push({name:"Namespace admin",value:h.admin,bAddress:!0}),this.nameDetailDialog.bVisible=!0}}},y=l=>(I("data-v-d10ad39e"),l=l(),E(),l),M=y(()=>i("div",{id:"inestTitle"},"Query many",-1)),H=y(()=>i("div",{id:"inestTip"},[i("div",null,"Query multiple names quickly!")],-1)),O={style:{"margin-top":"50px"}},U=y(()=>i("div",null,"Select namespaces:",-1)),z={style:{"margin-top":"32px"}},G=y(()=>i("div",null,"Enter names(only allow 0-9, a-z, _, one name per line, max 100 lines):",-1)),F={style:{margin:"10px auto"},class:"sstrong sBlack"},K={key:0},Z={class:"sstrong sBlack"},j={class:"ggeneric sGrey"},J={key:1},W=y(()=>i("div",{class:"sstrong sGrey"},"Not open registration",-1)),X=[W],Y={key:2},$=y(()=>i("div",{class:"sstrong sGrey"},"Registered",-1)),ee=[$],te={key:3},se=y(()=>i("div",{class:"sstrong sGrey"},"Unknown reason",-1)),ne=[se],le={key:0},ae={key:1},ie={key:0},oe={key:1},re={key:2},ce=["innerHTML"],ue={key:3};function de(l,a,h,m,t,p){const b=g("el-checkbox"),L=g("el-checkbox-group"),N=g("el-input"),v=g("el-button"),_=g("el-table-column"),n=g("el-table"),s=g("el-link"),S=g("el-dialog");return r(),d("div",null,[M,H,i("div",O,[U,c(L,{modelValue:t.checkList,"onUpdate:modelValue":a[0]||(a[0]=e=>t.checkList=e)},{default:u(()=>[(r(!0),d(T,null,q(t.allNSList.length,e=>(r(),C(b,{size:"large",key:e,label:"."+t.allNSList[e-1]},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),i("div",z,[G,c(N,{modelValue:t.namesStr,"onUpdate:modelValue":a[1]||(a[1]=e=>t.namesStr=e),style:{width:"600px","margin-top":"8px"},rows:16,type:"textarea",placeholder:"satoshi"},null,8,["modelValue"]),i("div",null,[c(v,{type:"primary",size:"large",style:{"margin-top":"8px"},disabled:t.namesStr.trim().length==0,onClick:p.onClickQuery},{default:u(()=>[w("Query")]),_:1},8,["disabled","onClick"])]),i("div",null,[t.queryResultList.length>0?(r(),C(n,{key:0,data:t.queryResultList,style:{margin:"50px auto",width:"600px"},"empty-text":"Empty"},{default:u(()=>[c(_,{label:"Results",width:"180"},{default:u(e=>[i("div",F,f(e.row.fullName),1)]),_:1}),c(_,{label:""},{default:u(e=>[e.row.bCanRegister?(r(),d("div",K,[i("div",Z,f(t.u.float2Str(t.e.utils.formatEther(e.row.registerPrice)))+" eth",1),i("div",j,f(e.row.renewalStr),1)])):e.row.bOpenRegistration?e.row.owner!=t.e.ZeroAddress?(r(),d("div",Y,ee)):(r(),d("div",te,ne)):(r(),d("div",J,X))]),_:1}),c(_,{label:"Action",width:"150"},{default:u(e=>[e.row.bCanRegister?(r(),d("div",le,[c(v,{type:"primary",style:{width:"120px"},onClick:R=>p.onClickRegister(e.row)},{default:u(()=>[w("Register")]),_:2},1032,["onClick"])])):(r(),d("div",ae,[c(v,{type:"info",style:{width:"120px"},onClick:R=>p.onClickDetail(e.row)},{default:u(()=>[w("Detail")]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["data"])):P("",!0)])]),c(S,{modelValue:t.nameDetailDialog.bVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>t.nameDetailDialog.bVisible=e),title:t.nameDetailDialog.fullName,width:"800px","align-center":""},{default:u(()=>[c(n,{data:t.nameDetailDialog.tableData,style:{width:"100%",margin:"0px auto"},stripe:"",border:""},{default:u(()=>[c(_,{prop:"name",label:"Name",width:"150",align:"center"}),c(_,{label:"Content"},{default:u(e=>[e.row.bAddress?(r(),d("div",ie,[c(s,{class:"elink",href:"https://etherscan.io/address/"+e.row.value,target:"_blank"},{default:u(()=>[w(f(e.row.value),1)]),_:2},1032,["href"])])):e.row.bLink?(r(),d("div",oe,[c(s,{class:"elink",href:e.row.value,target:"_blank"},{default:u(()=>[w(f(e.row.value),1)]),_:2},1032,["href"])])):e.row.bHtml?(r(),d("div",re,[i("div",{innerHTML:e.row.value},null,8,ce)])):(r(),d("div",ue,f(e.row.value),1))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}const ge=D(A,[["render",de],["__scopeId","data-v-d10ad39e"]]);export{ge as default};
